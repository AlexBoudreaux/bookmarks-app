# Ralph Progress Log

Started: 2026-01-22

## Codebase Patterns

(Add reusable patterns here as you discover them)

- Supabase client: Use `@/lib/supabase` for all database queries
- Components: Use shadcn/ui from `@/components/ui/`
- Styling: Tailwind + `cn()` from `@/lib/utils`
- Path alias: `@/*` maps to `./src/*`
- Testing: Vitest for unit tests (`src/**/*.test.ts`), Playwright for E2E (`e2e/**/*.spec.ts`)
- Test imports: Use `@/` path alias in tests (configured in vitest.config.ts)
- Chrome bookmarks: Parse using `parseBookmarksHtml()` from `@/lib/parse-bookmarks`
- Boundary detection: Use `detectBoundary()` from `@/lib/detect-boundary` to split keepers vs to-categorize
- Tweet detection: Use regex `/(?:twitter\.com|x\.com)\/\w+\/status\/\d+/`
- happy-dom quirk: Nested DL tags are children of DT elements, not siblings

## Key Files

- `src/lib/supabase.ts` - Supabase client
- `supabase/migrations/` - Database migrations
- `PRD.md` - Full product requirements
- `CLAUDE.md` - Coding conventions

---

## 2026-01-22 - SETUP-001
- Verified Vitest infrastructure was already configured
- Created sample test in `src/lib/utils.test.ts`
- Test validates `cn()` function merges classes correctly using clsx + tailwind-merge
- All 6 test cases pass: basic merge, conditionals, conflicting classes, empty inputs, null/undefined, arrays/objects
- Build passes with no type errors

**Files changed:**
- `src/lib/utils.test.ts` (created)
- `package.json` (added happy-dom and @vitest/ui)

**Learnings:**
- Vitest config was already set up with jsdom environment, path aliases (@/), and test setup file
- The cn() utility combines clsx (conditional classes) with tailwind-merge (resolves conflicting Tailwind classes)
- Test naming pattern: `src/**/*.test.ts` for unit tests, `e2e/**/*.spec.ts` for E2E tests

---

## 2026-01-22 - SETUP-002
- Generated TypeScript types from Supabase remote database
- Used `supabase gen types typescript --linked` to generate from linked project
- Created `src/types/database.ts` with complete type definitions
- Includes all four tables: bookmarks, categories, settings, bookmark_categories
- Build passes with no type errors

**Files changed:**
- `src/types/database.ts` (created)

**Learnings:**
- Supabase CLI can generate types from remote project using `--linked` flag
- No need for local Docker instance to generate types
- Generated types include Row, Insert, Update types for each table plus utility types
- Types include the `embedding` vector column for future semantic search

---

## 2026-01-22 - SETUP-003
- Created migration `002_seed_starter_categories.sql` to populate starter categories
- Seeded 9 main categories with 42 subcategories (51 total)
- Categories match PRD specification exactly
- Migration successfully applied via `supabase db push`
- Verified all categories in remote database

**Files changed:**
- `supabase/migrations/002_seed_starter_categories.sql` (created)
- `scripts/verify-categories.ts` (created for verification)

**Learnings:**
- Migration pattern: Insert main categories first, then use SELECT subquery to get parent_id for subcategories
- Each INSERT for subcategories uses `SELECT id FROM categories WHERE name = 'ParentName' AND parent_id IS NULL` to find parent
- Verification script uses manual .env.local parsing since dotenv is not installed
- All 51 categories successfully inserted with correct hierarchy (9 main + 42 sub)

---

## 2026-01-22 - IMP-001
- Implemented Chrome HTML bookmark parser in `src/lib/parse-bookmarks.ts`
- Created comprehensive test suite with 12 test cases in `src/lib/parse-bookmarks.test.ts`
- Parser extracts URL, title, addDate, folderPath, and isTweet from Netscape bookmark format
- Handles nested folder structures correctly
- Detects tweet URLs from both twitter.com and x.com domains
- Supports both DOMParser (browser/happy-dom) and manual regex parsing (Node.js)
- All tests pass, build passes with no type errors

**Files changed:**
- `src/lib/parse-bookmarks.ts` (created)
- `src/lib/parse-bookmarks.test.ts` (created)

**Learnings:**
- happy-dom DOM structure differs from browser: nested DL tags appear as CHILDREN of DT elements, not siblings
- Chrome bookmark format uses Unix timestamps in seconds (not milliseconds) for ADD_DATE attribute
- The `<p>` tags in bookmark HTML are parsed as separate elements by happy-dom
- Tweet detection regex: `/(?:twitter\.com|x\.com)\/\w+\/status\/\d+/`
- Folder paths built by maintaining a stack that grows/shrinks as we enter/exit DL elements

---

## 2026-01-22 - IMP-002
- Implemented boundary detection logic in `src/lib/detect-boundary.ts`
- Created comprehensive test suite with 8 test cases in `src/lib/detect-boundary.test.ts`
- Function finds last occurrence of byebyepaywall.com URL in Tools folder
- Returns keeper count (bookmarks before boundary) and toCategorizeCount (bookmarks after)
- Case-insensitive folder matching for "Tools"
- Handles nested folder paths correctly (e.g., "Bookmarks Bar/Work/Tools")
- All tests pass, build passes with no type errors

**Files changed:**
- `src/lib/detect-boundary.ts` (created)
- `src/lib/detect-boundary.test.ts` (created)

**Learnings:**
- Boundary detection searches backward (from end) to find LAST occurrence of target URL in Tools folder
- Folder name matching requires exact folder part match, not substring (prevents false matches)
- BoundaryResult interface provides clean API: boundaryFound boolean + counts
- When boundary not found, all bookmarks default to toCategorizeCount with keeperCount=0

---

## 2026-01-22 - IMP-003
- Implemented import page dropzone UI with TDD approach
- Created client component `Dropzone` in `src/components/import/dropzone.tsx`
- Updated home page (`src/app/page.tsx`) with fixed header and centered layout
- Added drag-and-drop file upload with visual feedback (hover glow, scale animations)
- Included Chrome export instructions with numbered steps
- Created comprehensive tests in `src/app/page.test.tsx` (4 tests, all passing)
- Screenshot verified UI matches design aesthetic: sleek minimal dashboard, dark theme, polished
- Build passes with no type errors, all 30 tests passing

**Files changed:**
- `src/components/import/dropzone.tsx` (created)
- `src/app/page.tsx` (updated)
- `src/app/page.test.tsx` (created)
- `package.json` (added @testing-library/react, @testing-library/user-event, @testing-library/jest-dom)

**Learnings:**
- TDD workflow effective: write failing tests first, implement until passing
- Testing React Server Components requires rendering the awaited component: `render(await Home())`
- Use `getAllByText` for elements that intentionally appear multiple times on the page
- Mock Supabase responses with `vi.fn()` to control test scenarios (0 bookmarks vs 10+ bookmarks)
- Screenshot verification with dev-browser confirms visual design matches intent
- Dark theme uses CSS variables from globals.css, maintaining consistency across components
- Client components (`'use client'`) needed for interactive elements (drag/drop, state)
- Lucide-react icons (Upload, ArrowRight) for clean, consistent iconography

**Aesthetic decisions:**
- Refined minimal dashboard aesthetic (not bold/flashy)
- Subtle animations: glow on hover, scale transform, smooth transitions
- Radial gradient glow effect on dropzone hover/drag states
- Numbered instruction steps with circular badges using primary color
- Fixed header with backdrop blur for polished feel
- Dark theme only (as specified in PRD)

---
